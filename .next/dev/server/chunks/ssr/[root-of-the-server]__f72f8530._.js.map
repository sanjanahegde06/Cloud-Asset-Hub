{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///D:/cloud-asset-hub/lib/supabaseClient.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,iKAAY,EAAC,aAAa","debugId":null}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["file:///D:/cloud-asset-hub/components/ProtectedRoute.js"],"sourcesContent":["import { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { supabase } from '../lib/supabaseClient';\n\nexport default function ProtectedRoute({ children }) {\n  const router = useRouter();\n\n  useEffect(() => {\n    const checkUser = async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        router.push('/');\n      }\n    };\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\n      if (!session) {\n        router.push('/');\n      }\n    });\n\n    checkUser();\n    return () => subscription.unsubscribe();\n  }, [router]);\n\n  return <>{children}</>;\n}"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAEe,SAAS,eAAe,EAAE,QAAQ,EAAE;IACjD,MAAM,SAAS,IAAA,oIAAS;IAExB,IAAA,gHAAS,EAAC;QACR,MAAM,YAAY;YAChB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,0HAAQ,CAAC,IAAI,CAAC,UAAU;YAC5D,IAAI,CAAC,SAAS;gBACZ,OAAO,IAAI,CAAC;YACd;QACF;QAEA,MAAM,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE,GAAG,0HAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,OAAO;YACzE,IAAI,CAAC,SAAS;gBACZ,OAAO,IAAI,CAAC;YACd;QACF;QAEA;QACA,OAAO,IAAM,aAAa,WAAW;IACvC,GAAG;QAAC;KAAO;IAEX,qBAAO;kBAAG;;AACZ","debugId":null}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///D:/cloud-asset-hub/pages/profile.js"],"sourcesContent":["import { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/router'\r\nimport ProtectedRoute from '../components/ProtectedRoute'\r\nimport { supabase } from '../lib/supabaseClient'\r\n\r\nfunction humanBytes(bytes) {\r\n  if (!bytes && bytes !== 0) return '0 B'\r\n  const units = ['B', 'KB', 'MB', 'GB', 'TB']\r\n  let i = 0\r\n  let b = Number(bytes)\r\n  while (b >= 1024 && i < units.length - 1) {\r\n    b /= 1024\r\n    i++\r\n  }\r\n  return `${b.toFixed(b >= 100 ? 0 : 1)} ${units[i]}`\r\n}\r\n\r\nfunction calculatePercentage(used, total) {\r\n  if (!total) return 0\r\n  // Convert to numbers and ensure proper precision\r\n  const usedBytes = Number(used) || 0\r\n  const totalBytes = Number(total) || 1\r\n  return Math.min(100, Math.max(0, (usedBytes / totalBytes) * 100))\r\n}\r\n\r\nexport default function Profile() {\r\n  const [user, setUser] = useState(null)\r\n  const [totalBytes, setTotalBytes] = useState(0)\r\n  const [totalFiles, setTotalFiles] = useState(0)\r\n  const [loading, setLoading] = useState(true)\r\n  const router = useRouter()\r\n  \r\n  // Ensure quota is a proper number\r\n  const quotaBytes = Number(process.env.NEXT_PUBLIC_USER_QUOTA_BYTES) || 1024 * 1024 * 1024 // 1 GB default\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n\r\n    async function load() {\r\n      setLoading(true)\r\n      try {\r\n        const { data } = await supabase.auth.getUser()\r\n        const currentUser = data?.user ?? null\r\n        if (!mounted) return\r\n        setUser(currentUser)\r\n\r\n        if (!currentUser) {\r\n          setTotalBytes(0)\r\n          return\r\n        }\r\n\r\n        // fetch all files with pagination to sum sizes\r\n        const pageSize = 1000\r\n        let offset = 0\r\n        let allFiles = []\r\n        while (true) {\r\n          const res = await supabase.storage.from('uploads').list(currentUser.id, { limit: pageSize, offset })\r\n          if (res.error) throw res.error\r\n          const items = res.data || []\r\n          allFiles = allFiles.concat(items)\r\n          if (items.length < pageSize) break\r\n          offset += pageSize\r\n        }\r\n\r\n        const bytes = allFiles.reduce((acc, f) => {\r\n          const size = Number(f.size || f.metadata?.size || 0)\r\n          return acc + (isNaN(size) ? 0 : size)\r\n        }, 0)\r\n\r\n        if (mounted) setTotalBytes(bytes)\r\n        setTotalFiles(allFiles.length)\r\n      } catch (err) {\r\n        if (mounted) setTotalBytes(0)\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [])\r\n\r\n  const handleLogout = async () => {\r\n    await supabase.auth.signOut()\r\n    router.push('/')\r\n  }\r\n\r\n  // Calculate percentage with proper precision\r\n  const percentage = calculatePercentage(totalBytes, quotaBytes)\r\n  const displayPercentage = percentage.toFixed(2)\r\n\r\n  return (\r\n    <ProtectedRoute>\r\n      <div className=\"dashboard\">\r\n        <header className=\"dashboard-header\">\r\n          <h1>☁️ Cloud Asset Hub</h1>\r\n\r\n          <nav className=\"dashboard-nav\">\r\n            <Link href=\"/dashboard\">\r\n              <button className=\"btn ghost\" aria-label=\"Dashboard\">Dashboard</button>\r\n            </Link>\r\n            <button \r\n              className=\"btn ghost\" \r\n              onClick={handleLogout} \r\n              style={{ marginLeft: '1rem' }}\r\n              aria-label=\"Logout\"\r\n            >\r\n              Logout\r\n            </button>\r\n          </nav>\r\n        </header>\r\n\r\n        <div className=\"profile-page-container\">\r\n          <div className=\"profile-standalone card\">\r\n            <h3>My Profile</h3>\r\n\r\n            <p><strong>Email:</strong> {user?.email ?? '—'}</p>\r\n            <p><strong>User ID:</strong> {user?.id ?? '—'}</p>\r\n            <p><strong>Total Files:</strong> {totalFiles}</p>\r\n            <p>\r\n              <strong>Storage Used:</strong> {humanBytes(totalBytes)} of {humanBytes(quotaBytes)} ({displayPercentage}%)\r\n            </p>\r\n\r\n            <div style={{ marginTop: 12 }}>\r\n              <div \r\n                style={{ \r\n                  height: 14, \r\n                  background: '#eef2ff', \r\n                  borderRadius: 999, \r\n                  overflow: 'hidden',\r\n                  border: '1px solid #e5e7eb'\r\n                }}\r\n              >\r\n                <div \r\n                  style={{ \r\n                    width: `${percentage}%`, \r\n                    height: '100%', \r\n                    background: '#4f46e5', \r\n                    borderRadius: 999,\r\n                    transition: 'width 0.3s ease-out',\r\n                    minWidth: totalBytes > 0 ? '4px' : '0'\r\n                  }} \r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}